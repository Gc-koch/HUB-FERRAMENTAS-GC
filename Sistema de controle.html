<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle - Ação do Real</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary-color);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border: none;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border: none;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border: none;
        }
        
        .calendar-day {
            border: 1px solid #dee2e6;
            height: 120px;
            padding: 5px;
            overflow-y: auto;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .calendar-day.active {
            background-color: rgba(46, 204, 113, 0.2);
        }
        
        .calendar-day.warning {
            background-color: rgba(243, 156, 18, 0.2);
        }
        
        .calendar-day-header {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .items-count {
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        
        .event-item {
            font-size: 0.75rem;
            background-color: var(--secondary-color);
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            margin-bottom: 2px;
            cursor: pointer;
        }
        
        .event-item.warning {
            background-color: var(--warning-color);
        }
        
        .event-item.danger {
            background-color: var(--danger-color);
        }
        
        /* Estilos para tabela redimensionável */
        .resizable-table th {
            background-color: var(--primary-color);
            color: white;
            cursor: col-resize;
            position: relative;
            user-select: none;
            min-width: 50px;
            padding: 12px 8px;
            font-size: 0.95rem;
        }
        
        .resizable-table th .resize-handle {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            cursor: col-resize;
            background-color: transparent;
            z-index: 10;
        }
        
        .resizable-table th .resize-handle:hover,
        .resizable-table th .resize-handle.resizing {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .resizable-table td {
            padding: 14px 10px;
            vertical-align: middle;
            min-width: 80px;
            max-width: 500px;
            word-wrap: break-word;
            font-size: 0.95rem;
        }
        
        .alert-section {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .alert-item {
            padding: 10px;
            border-left: 4px solid var(--warning-color);
            margin-bottom: 10px;
            background-color: white;
            border-radius: 0 5px 5px 0;
        }
        
        .alert-item.danger {
            border-left-color: var(--danger-color);
        }
        
        .email-modal textarea {
            min-height: 150px;
        }
        
        .calendar-view-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .day-details {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .checkbox-item {
            margin-right: 8px;
        }
        
        .selected-count {
            background-color: var(--warning-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .history-section {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .nav-tabs .nav-link {
            color: var(--primary-color);
        }
        
        .history-view {
            display: none;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .year-selector {
            max-width: 120px;
        }
        
        .sazonalidade-badge {
            font-size: 0.7rem;
            margin-left: 5px;
        }
        
        .sazonalidade-inverno { background-color: #3498db; }
        .sazonalidade-verao { background-color: #e74c3c; }
        .sazonalidade-blackfriday { background-color: #2c3e50; }
        .sazonalidade-fimdeano { background-color: #9b59b6; }
        .sazonalidade-natal { background-color: #27ae60; }
        .sazonalidade-oportunidade { background-color: #f39c12; }
        .sazonalidade-promocional { background-color: #e67e22; }
        
        .observacoes-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            max-height: 100px;
            overflow-y: auto;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        /* Estilos para o redimensionamento de colunas */
        .table-wrapper {
            position: relative;
            overflow-x: auto;
        }
        
        .resize-indicator {
            position: absolute;
            background-color: var(--secondary-color);
            width: 2px;
            height: 100%;
            top: 0;
            z-index: 1000;
            pointer-events: none;
            display: none;
        }
        
        /* Melhorar a visualização do texto longo */
        .text-truncate-custom {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            line-height: 1.4;
            max-height: 5.6em; /* 4 linhas * 1.4 line-height */
        }
        
        /* CONTÊINER PRINCIPAL - Aumentado em 40% */
        .main-container {
            width: 100%;
            max-width: 1600px; /* Aumentado de ~1140px para 1600px (40% a mais) */
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* CARD DA LISTA DE OFERTAS - Aumentado */
        .wide-list-card {
            width: 100%;
            margin-left: 0;
            margin-right: 0;
        }
        
        .wide-list-card .card-body {
            padding: 25px; /* Aumentado de 20px para 25px */
        }
        
        /* TABELA DA LISTA - Aumentada */
        .wide-table-container {
            width: 100%;
        }
        
        .wide-table-container .table-wrapper {
            width: 100%;
        }
        
        .wide-table-container .resizable-table {
            width: 100%;
            table-layout: auto;
        }
        
        .wide-table-container .resizable-table th {
            padding: 15px 12px; /* Aumentado padding */
            font-size: 1rem; /* Aumentado de 0.95rem */
            min-width: 140px; /* Aumentado mínimo */
        }
        
        .wide-table-container .resizable-table td {
            padding: 16px 12px; /* Aumentado padding */
            font-size: 1rem; /* Aumentado de 0.95rem */
            min-width: 140px; /* Aumentado mínimo */
            max-width: 700px; /* Aumentado máximo */
        }
        
        /* Larguras específicas para colunas (aumentadas 40%) */
        .wide-table-container .resizable-table th:nth-child(1) { /* Nome */
            min-width: 250px; /* Aumentado de ~180px */
        }
        
        .wide-table-container .resizable-table th:nth-child(2) { /* Sazonalidade */
            min-width: 280px; /* Aumentado de ~200px */
        }
        
        .wide-table-container .resizable-table th:nth-child(3) { /* Código Interno */
            min-width: 210px; /* Aumentado de ~150px */
        }
        
        .wide-table-container .resizable-table th:nth-child(4) { /* EAN */
            min-width: 224px; /* Aumentado de ~160px */
        }
        
        .wide-table-container .resizable-table th:nth-child(5) { /* Observações */
            min-width: 420px; /* Aumentado de ~300px */
        }
        
        .wide-table-container .resizable-table th:nth-child(6),
        .wide-table-container .resizable-table th:nth-child(7) { /* Datas */
            min-width: 196px; /* Aumentado de ~140px */
        }
        
        .wide-table-container .resizable-table th:nth-child(8) { /* Status */
            min-width: 210px; /* Aumentado de ~150px */
        }
        
        .wide-table-container .resizable-table th:nth-child(9) { /* Ações */
            min-width: 154px; /* Aumentado de ~110px */
        }
        
        /* Contador de itens */
        .items-count-badge {
            background-color: var(--secondary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        /* Botão para redefinir larguras */
        .reset-columns-btn {
            padding: 4px 10px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        /* Estilo para cabeçalhos de tabela com espaço para redimensionar */
        .table-header-wrapper {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--primary-color);
        }
        
        /* Aumentar tamanho da fonte da tabela principal */
        #itemsTable {
            font-size: 1rem; /* Aumentado */
        }
        
        /* Ajustar layout geral para acomodar a tabela maior */
        .row {
            margin-right: -10px;
            margin-left: -10px;
        }
        
        .col-md-4, .col-md-8 {
            padding-right: 10px;
            padding-left: 10px;
        }
        
        /* Aumentar outros componentes para manter proporção */
        .card-header {
            padding: 18px 25px; /* Aumentado */
            font-size: 1.1rem; /* Aumentado */
        }
        
        .card-body {
            padding: 25px; /* Aumentado */
        }
        
        .form-control, .form-select {
            padding: 10px 12px; /* Aumentado */
            font-size: 1rem; /* Aumentado */
        }
        
        .btn {
            padding: 10px 20px; /* Aumentado */
            font-size: 1rem; /* Aumentado */
        }
        
        .btn-sm {
            padding: 6px 12px; /* Aumentado */
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="main-container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-graph-up"></i> Ação do Real - Controle de Ofertas
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active inicio-link" href="#" data-view="inicio">
                            <i class="bi bi-house"></i> Início
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link history-link" href="#" data-view="history">
                            <i class="bi bi-clock-history"></i> Histórico
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#configModal">
                            <i class="bi bi-gear"></i> Configurações
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container mt-4">
        <!-- View Início -->
        <div id="inicioView">
            <div class="row">
                <!-- Coluna Esquerda: Formulário e Alertas -->
                <div class="col-md-4">
                    <!-- Formulário de Cadastro -->
                    <div class="card">
                        <div class="card-header">
                            <i class="bi bi-plus-circle"></i> Cadastrar Nova Oferta
                        </div>
                        <div class="card-body">
                            <form id="itemForm">
                                <div class="mb-3">
                                    <label for="itemName" class="form-label">Nome do Item</label>
                                    <input type="text" class="form-control" id="itemName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="sazonalidade" class="form-label">Tipo de Sazonalidade</label>
                                    <select class="form-select" id="sazonalidade" required>
                                        <option value="">Selecione a sazonalidade...</option>
                                        <option value="ARTIGOS DE INVERNO">ARTIGOS DE INVERNO</option>
                                        <option value="ARTIGOS DE VERAO">ARTIGOS DE VERÃO</option>
                                        <option value="BLACK FRIDAY">BLACK FRIDAY</option>
                                        <option value="FIM DE ANO">FIM DE ANO</option>
                                        <option value="NATAL">NATAL</option>
                                        <option value="OPORTUNIDADE">OPORTUNIDADE</option>
                                        <option value="PROMOCIONAL(ACAO DO REAL)">PROMOCIONAL (AÇÃO DO REAL)</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="internalCode" class="form-label">Código Interno</label>
                                    <input type="text" class="form-control" id="internalCode" required>
                                </div>
                                <div class="mb-3">
                                    <label for="eanCode" class="form-label">Código EAN</label>
                                    <input type="text" class="form-control" id="eanCode" required>
                                </div>
                                <div class="mb-3">
                                    <label for="observacoes" class="form-label">Observações</label>
                                    <textarea class="form-control" id="observacoes" rows="3" placeholder="Informações adicionais sobre a oferta..."></textarea>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="startDate" class="form-label">Data Inicial</label>
                                        <input type="date" class="form-control" id="startDate" min="2025-01-01" max="2026-12-31" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="endDate" class="form-label">Data Final</label>
                                        <input type="date" class="form-control" id="endDate" min="2025-01-01" max="2026-12-31" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-save"></i> Salvar Oferta
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Alertas -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-bell"></i> Alertas de Expiração</span>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-1" id="selectAllBtn">
                                    <i class="bi bi-check-all"></i> Todos
                                </button>
                                <button class="btn btn-sm btn-warning" id="sendBulkEmailBtn" disabled>
                                    <i class="bi bi-envelope"></i> Email
                                    <span class="selected-count" id="selectedCount">0</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body alert-section" id="alertsContainer">
                            <!-- Alertas serão inseridos aqui dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Coluna Direita: Calendário e Lista (AUMENTADA 40%) -->
                <div class="col-md-8">
                    <!-- Calendário -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-calendar-event"></i> Calendário de Ofertas</span>
                            <div class="d-flex align-items-center">
                                <select class="form-select form-select-sm year-selector me-2" id="yearSelector">
                                    <option value="2025" selected>2025</option>
                                    <option value="2026">2026</option>
                                </select>
                                <div>
                                    <button class="btn btn-sm btn-outline-secondary" id="prevMonth">
                                        <i class="bi bi-chevron-left"></i>
                                    </button>
                                    <span id="currentMonth" class="mx-2">Outubro 2025</span>
                                    <button class="btn btn-sm btn-outline-secondary" id="nextMonth">
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="calendar" class="table-responsive">
                                <!-- Calendário será gerado aqui dinamicamente -->
                            </div>
                        </div>
                    </div>
		</div>    <!-- ALTERACAO FEITA AQ ADD DIV -->
     
                    <!-- Lista de Itens - AUMENTADA 40% -->
                    <div class="card wide-list-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <div>
                                <span><i class="bi bi-list-ul"></i> Lista de Ofertas Ativas</span>
                                <span class="items-count-badge" id="activeItemsCount">0 itens</span>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary reset-columns-btn" id="resetColumnsBtn" title="Redefinir larguras das colunas">
                                    <i class="bi bi-arrow-clockwise"></i> Redefinir Colunas
                                </button>
                                <button class="btn btn-sm btn-outline-primary ms-1" id="exportDataBtn">
                                    <i class="bi bi-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="wide-table-container">
                                <div class="table-wrapper">
                                    <div class="resize-indicator" id="resizeIndicator"></div>
                                    <table class="table table-striped table-hover resizable-table" id="resizableTable">
                                        <thead>
                                            <tr>
                                                <th data-column="name">Nome <div class="resize-handle"></div></th>
                                                <th data-column="sazonalidade">Sazonalidade <div class="resize-handle"></div></th>
                                                <th data-column="internalCode">Código Interno <div class="resize-handle"></div></th>
                                                <th data-column="eanCode">EAN <div class="resize-handle"></div></th>
                                                <th data-column="observacoes">Observações <div class="resize-handle"></div></th>
                                                <th data-column="startDate">Data Inicial <div class="resize-handle"></div></th>
                                                <th data-column="endDate">Data Final <div class="resize-handle"></div></th>
                                                <th data-column="status">Status <div class="resize-handle"></div></th>
                                                <th data-column="actions">Ações <div class="resize-handle"></div></th>
                                            </tr>
                                        </thead>
                                        <tbody id="itemsTable">
                                            <!-- Itens serão inseridos aqui dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Histórico -->
        <div id="historyView" class="history-view">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-clock-history"></i> Histórico de Ofertas Expiradas</span>
                    <div class="d-flex align-items-center">
                        <input type="text" class="form-control form-control-sm me-2" id="historySearch" placeholder="Buscar no histórico..." style="width: 400px;">
                        <button class="btn btn-sm btn-danger" id="clearHistoryBtn">
                            <i class="bi bi-trash"></i> Limpar Histórico
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Sazonalidade</th>
                                    <th>Código Interno</th>
                                    <th>EAN</th>
                                    <th>Observações</th>
                                    <th>Data Inicial</th>
                                    <th>Data Final</th>
                                    <th>Data de Remoção</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="historyTable">
                                <!-- Histórico será inserido aqui dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Dia -->
    <div class="modal fade" id="dayDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dayDetailsTitle">Detalhes do Dia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="dayDetailsContent" class="day-details">
                        <!-- Conteúdo será inserido aqui dinamicamente -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Email -->
    <div class="modal fade" id="emailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Enviar Email de Alerta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="emailTo" class="form-label">Destinatário</label>
                        <input type="email" class="form-control" id="emailTo" placeholder="email@exemplo.com">
                    </div>
                    <div class="mb-3">
                        <label for="emailSubject" class="form-label">Assunto</label>
                        <input type="text" class="form-control" id="emailSubject" value="Alerta: Ofertas prestes a expirar">
                    </div>
                    <div class="mb-3">
                        <label for="emailBody" class="form-label">Mensagem</label>
                        <textarea class="form-control" id="emailBody" rows="6">
Prezado(a),

Gostaríamos de informar que as seguintes ofertas estão prestes a expirar:

[LISTA_DE_PRODUTOS]

Atenciosamente,
Equipe Ação do Real
                        </textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="sendEmailBtn">Enviar Email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Configurações -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Configurações do Sistema</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="alertDays" class="form-label">Dias para alerta de expiração</label>
                        <input type="number" class="form-control" id="alertDays" value="3" min="1" max="30">
                    </div>
                    <div class="mb-3">
                        <label for="defaultEmail" class="form-label">Email padrão para alertas</label>
                        <input type="email" class="form-control" id="defaultEmail" placeholder="email@exemplo.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Exportar/Importar Dados</label>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" id="backupDataBtn">
                                <i class="bi bi-download"></i> Fazer Backup dos Dados
                            </button>
                            <button class="btn btn-outline-secondary" id="restoreDataBtn">
                                <i class="bi bi-upload"></i> Restaurar Dados do Backup
                            </button>
                            <input type="file" id="restoreFileInput" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" id="saveConfigBtn">Salvar Configurações</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dados de exemplo baseados no print
        let items = JSON.parse(localStorage.getItem('acaoDoRealItems')) || [
            {
                id: 1,
                name: "SAND HAVAIANA",
                sazonalidade: "ARTIGOS DE VERAO",
                internalCode: "123",
                eanCode: "78945645456",
                observacoes: "Promoção especial para o verão",
                startDate: "2025-10-20",
                endDate: "2025-10-28",
                active: true,
                status: "ativo"
            },
            {
                id: 2,
                name: "DASDA",
                sazonalidade: "PROMOCIONAL(ACAO DO REAL)",
                internalCode: "123123",
                eanCode: "1323231",
                observacoes: "Item com desconto especial",
                startDate: "2025-10-27",
                endDate: "2025-10-29",
                active: true,
                status: "ativo"
            },
            {
                id: 3,
                name: "QWQWEQ",
                sazonalidade: "OPORTUNIDADE",
                internalCode: "23131",
                eanCode: "12123132233232",
                observacoes: "Oferta por tempo limitado",
                startDate: "2025-10-26",
                endDate: "2025-10-28",
                active: true,
                status: "ativo"
            },
            {
                id: 4,
                name: "EEEEQQQW",
                sazonalidade: "BLACK FRIDAY",
                internalCode: "2323133",
                eanCode: "3232312313",
                observacoes: "Preço Black Friday exclusivo",
                startDate: "2025-10-26",
                endDate: "2025-10-28",
                active: true,
                status: "ativo"
            },
            {
                id: 5,
                name: "QQQQ",
                sazonalidade: "NATAL",
                internalCode: "222",
                eanCode: "3333",
                observacoes: "Promoção de natal, estoque limitado",
                startDate: "2025-10-26",
                endDate: "2025-11-06",
                active: true,
                status: "ativo"
            }
        ];

        // Histórico de itens expirados
        let historyItems = JSON.parse(localStorage.getItem('acaoDoRealHistory')) || [];

        // Configurações
        let settings = JSON.parse(localStorage.getItem('acaoDoRealSettings')) || {
            alertDays: 3,
            defaultEmail: ""
        };

        // Variáveis para controle do calendário
        let currentDate = new Date('2025-10-26'); // Data base para mostrar outubro 2025
        let currentMonth = currentDate.getMonth();
        let currentYear = 2025; // Ano inicial
        let selectedItems = [];

        // Variáveis para redimensionamento de colunas
        let isResizing = false;
        let currentResizeColumn = null;
        let startX = 0;
        let startWidth = 0;

        // Função para obter classe CSS da sazonalidade
        function getSazonalidadeClass(sazonalidade) {
            const classes = {
                'ARTIGOS DE INVERNO': 'sazonalidade-inverno',
                'ARTIGOS DE VERAO': 'sazonalidade-verao',
                'BLACK FRIDAY': 'sazonalidade-blackfriday',
                'FIM DE ANO': 'sazonalidade-fimdeano',
                'NATAL': 'sazonalidade-natal',
                'OPORTUNIDADE': 'sazonalidade-oportunidade',
                'PROMOCIONAL(ACAO DO REAL)': 'sazonalidade-promocional'
            };
            return classes[sazonalidade] || 'bg-secondary';
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            renderCalendar(currentMonth, currentYear);
            renderItemsTable();
            renderHistoryTable();
            checkAlerts();
            loadSettings();
            initColumnResize();

            // Event Listeners
            document.getElementById('itemForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('prevMonth').addEventListener('click', showPreviousMonth);
            document.getElementById('nextMonth').addEventListener('click', showNextMonth);
            document.getElementById('yearSelector').addEventListener('change', function() {
                currentYear = parseInt(this.value);
                currentMonth = 0; // Volta para janeiro quando muda o ano
                renderCalendar(currentMonth, currentYear);
            });
            document.getElementById('sendEmailBtn').addEventListener('click', sendEmail);
            document.getElementById('saveConfigBtn').addEventListener('click', saveSettings);
            document.getElementById('sendBulkEmailBtn').addEventListener('click', openBulkEmailModal);
            document.getElementById('selectAllBtn').addEventListener('click', selectAllAlerts);
            document.getElementById('historySearch').addEventListener('input', filterHistoryTable);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataBtn').addEventListener('click', triggerRestore);
            document.getElementById('restoreFileInput').addEventListener('change', restoreData);
            document.getElementById('resetColumnsBtn').addEventListener('click', resetColumnWidths);
            
            // Navegação entre views
            document.querySelector('.inicio-link').addEventListener('click', function(e) {
                e.preventDefault();
                switchMainView('inicio');
            });
            
            document.querySelector('.history-link').addEventListener('click', function(e) {
                e.preventDefault();
                switchMainView('history');
            });
        });

        // Função para inicializar o redimensionamento de colunas
        function initColumnResize() {
            const table = document.querySelector('#resizableTable');
            const headers = table.querySelectorAll('th');
            const indicator = document.getElementById('resizeIndicator');
            
            headers.forEach(header => {
                const handle = header.querySelector('.resize-handle');
                
                handle.addEventListener('mousedown', function(e) {
                    isResizing = true;
                    currentResizeColumn = header;
                    startX = e.pageX;
                    startWidth = header.offsetWidth;
                    
                    // Posicionar o indicador
                    const rect = header.getBoundingClientRect();
                    indicator.style.left = (rect.right - 1) + 'px';
                    indicator.style.display = 'block';
                    
                    // Adicionar classe de redimensionamento
                    handle.classList.add('resizing');
                    
                    e.preventDefault();
                    e.stopPropagation();
                });
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isResizing) return;
                
                const diffX = e.pageX - startX;
                const newWidth = Math.max(50, startWidth + diffX);
                
                // Atualizar posição do indicador
                const rect = currentResizeColumn.getBoundingClientRect();
                indicator.style.left = (rect.left + newWidth - 1) + 'px';
                
                // Atualizar largura da coluna
                const columnIndex = Array.from(currentResizeColumn.parentNode.children).indexOf(currentResizeColumn);
                const allRows = table.querySelectorAll('tr');
                
                allRows.forEach(row => {
                    const cell = row.children[columnIndex];
                    if (cell) {
                        cell.style.width = newWidth + 'px';
                        cell.style.minWidth = newWidth + 'px';
                        cell.style.maxWidth = 'none';
                    }
                });
                
                // Atualizar largura do cabeçalho
                currentResizeColumn.style.width = newWidth + 'px';
                currentResizeColumn.style.minWidth = newWidth + 'px';
                currentResizeColumn.style.maxWidth = 'none';
            });
            
            document.addEventListener('mouseup', function() {
                if (isResizing) {
                    isResizing = false;
                    indicator.style.display = 'none';
                    
                    if (currentResizeColumn) {
                        const handle = currentResizeColumn.querySelector('.resize-handle');
                        handle.classList.remove('resizing');
                        
                        // Salvar larguras das colunas
                        saveColumnWidths();
                        currentResizeColumn = null;
                    }
                }
            });
        }
        
        // Função para salvar larguras das colunas
        function saveColumnWidths() {
            const table = document.querySelector('#resizableTable');
            const headers = table.querySelectorAll('th');
            const widths = {};
            
            headers.forEach((header, index) => {
                const columnName = header.getAttribute('data-column');
                widths[columnName] = header.offsetWidth;
            });
            
            localStorage.setItem('acaoDoRealColumnWidths', JSON.stringify(widths));
        }
        
        // Função para carregar larguras das colunas salvas
        function loadColumnWidths() {
            const savedWidths = JSON.parse(localStorage.getItem('acaoDoRealColumnWidths'));
            if (!savedWidths) return;
            
            const table = document.querySelector('#resizableTable');
            const headers = table.querySelectorAll('th');
            
            headers.forEach(header => {
                const columnName = header.getAttribute('data-column');
                if (savedWidths[columnName]) {
                    const width = savedWidths[columnName];
                    const columnIndex = Array.from(header.parentNode.children).indexOf(header);
                    const allRows = table.querySelectorAll('tr');
                    
                    allRows.forEach(row => {
                        const cell = row.children[columnIndex];
                        if (cell) {
                            cell.style.width = width + 'px';
                            cell.style.minWidth = width + 'px';
                        }
                    });
                    
                    header.style.width = width + 'px';
                    header.style.minWidth = width + 'px';
                }
            });
        }
        
        // Função para redefinir larguras das colunas
        function resetColumnWidths() {
            if (confirm('Deseja redefinir todas as colunas para as larguras padrão?')) {
                localStorage.removeItem('acaoDoRealColumnWidths');
                renderItemsTable();
                
                // Re-inicializar redimensionamento
                setTimeout(() => {
                    initColumnResize();
                }, 100);
                
                alert('Colunas redefinidas para as larguras padrão!');
            }
        }

        // Funções de Navegação Principal
        function switchMainView(view) {
            if (view === 'inicio') {
                document.getElementById('inicioView').style.display = 'block';
                document.getElementById('historyView').style.display = 'none';
                document.querySelector('.inicio-link').classList.add('active');
                document.querySelector('.history-link').classList.remove('active');
            } else {
                document.getElementById('inicioView').style.display = 'none';
                document.getElementById('historyView').style.display = 'block';
                document.querySelector('.inicio-link').classList.remove('active');
                document.querySelector('.history-link').classList.add('active');
                renderHistoryTable();
            }
        }

        // Funções do Calendário
        function renderCalendar(month, year) {
            const calendarEl = document.getElementById('calendar');
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            document.getElementById('yearSelector').value = year;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const monthLength = lastDay.getDate();
            
            let calendarHTML = '<table class="table table-bordered">';
            calendarHTML += '<thead><tr>';
            
            const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            daysOfWeek.forEach(day => {
                calendarHTML += `<th class="text-center">${day}</th>`;
            });
            
            calendarHTML += '</tr></thead><tbody><tr>';
            
            // Dias vazios no início do mês
            let dayCount = 0;
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<td class="calendar-day"></td>';
                dayCount++;
            }
            
            // Dias do mês
            for (let day = 1; day <= monthLength; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayItems = getItemsForDate(dateStr);
                
                let dayClass = 'calendar-day';
                if (dayItems.length > 0) {
                    dayClass += ' active';
                }
                
                // Verificar se há itens prestes a expirar
                const warningItems = dayItems.filter(item => {
                    const endDate = new Date(item.endDate);
                    const today = new Date();
                    const diffTime = endDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return diffDays <= settings.alertDays && diffDays > 0;
                });
                
                if (warningItems.length > 0) {
                    dayClass += ' warning';
                }
                
                calendarHTML += `<td class="${dayClass}" onclick="openDayDetails('${dateStr}')">`;
                calendarHTML += `<div class="calendar-day-header">${day}`;
                
                if (dayItems.length > 0) {
                    calendarHTML += `<span class="items-count">${dayItems.length}</span>`;
                }
                
                calendarHTML += `</div>`;
                
                // Mostrar apenas os primeiros 2 itens
                dayItems.slice(0, 2).forEach(item => {
                    let itemClass = 'event-item';
                    const endDate = new Date(item.endDate);
                    const today = new Date();
                    const diffTime = endDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays <= settings.alertDays && diffDays > 0) {
                        itemClass += ' warning';
                    } else if (diffDays <= 0) {
                        itemClass += ' danger';
                    }
                    
                    calendarHTML += `<div class="${itemClass}" title="${item.name} - ${item.sazonalidade} - Expira em ${item.endDate}">${item.name}</div>`;
                });
                
                // Mostrar indicador se há mais itens
                if (dayItems.length > 2) {
                    calendarHTML += `<div class="text-muted" style="font-size: 0.7rem;">+${dayItems.length - 2} mais</div>`;
                }
                
                calendarHTML += '</td>';
                
                dayCount++;
                if (dayCount % 7 === 0) {
                    calendarHTML += '</tr><tr>';
                }
            }
            
            // Dias vazios no final do mês
            while (dayCount % 7 !== 0) {
                calendarHTML += '<td class="calendar-day"></td>';
                dayCount++;
            }
            
            calendarHTML += '</tr></tbody></table>';
            calendarEl.innerHTML = calendarHTML;
        }

        function getItemsForDate(date) {
            return items.filter(item => {
                const startDate = new Date(item.startDate);
                const endDate = new Date(item.endDate);
                const checkDate = new Date(date);
                
                return checkDate >= startDate && checkDate <= endDate;
            });
        }

        function showPreviousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
                document.getElementById('yearSelector').value = currentYear;
            }
            renderCalendar(currentMonth, currentYear);
        }

        function showNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
                document.getElementById('yearSelector').value = currentYear;
            }
            renderCalendar(currentMonth, currentYear);
        }

        // Funções de Detalhes do Dia
        function openDayDetails(dateStr) {
            const dayItems = getItemsForDate(dateStr);
            const date = new Date(dateStr);
            
            document.getElementById('dayDetailsTitle').textContent = `Ofertas do dia ${formatDate(date)}`;
            
            let detailsHTML = '';
            
            if (dayItems.length > 0) {
                dayItems.forEach(item => {
                    const sazonalidadeClass = getSazonalidadeClass(item.sazonalidade);
                    const observacoesHTML = item.observacoes ? 
                        `<div class="observacoes-text"><strong>Observações:</strong> ${item.observacoes}</div>` : '';
                    
                    detailsHTML += `
                    <div class="history-item">
                        <h6>${item.name} <span class="badge ${sazonalidadeClass} sazonalidade-badge">${item.sazonalidade}</span></h6>
                        <div class="row">
                            <div class="col-md-4">
                                <strong>Código Interno:</strong> ${item.internalCode}
                            </div>
                            <div class="col-md-4">
                                <strong>EAN:</strong> ${item.eanCode}
                            </div>
                            <div class="col-md-4">
                                <strong>Expira em:</strong> ${formatDate(new Date(item.endDate))}
                            </div>
                        </div>
                        ${observacoesHTML}
                    </div>
                    `;
                });
            } else {
                detailsHTML = '<p class="text-muted text-center">Nenhuma oferta para este dia.</p>';
            }
            
            document.getElementById('dayDetailsContent').innerHTML = detailsHTML;
            
            const dayDetailsModal = new bootstrap.Modal(document.getElementById('dayDetailsModal'));
            dayDetailsModal.show();
        }

        // Funções do Formulário e Lista
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const newItem = {
                id: items.length > 0 ? Math.max(...items.map(item => item.id)) + 1 : 1,
                name: document.getElementById('itemName').value,
                sazonalidade: document.getElementById('sazonalidade').value,
                internalCode: document.getElementById('internalCode').value,
                eanCode: document.getElementById('eanCode').value,
                observacoes: document.getElementById('observacoes').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                active: true,
                status: "ativo"
            };
            
            items.push(newItem);
            saveItems();
            renderItemsTable();
            renderCalendar(currentMonth, currentYear);
            checkAlerts();
            
            // Limpar formulário
            document.getElementById('itemForm').reset();
            
            // Mostrar mensagem de sucesso
            alert('Oferta cadastrada com sucesso!');
        }

        function renderItemsTable() {
            const tableBody = document.getElementById('itemsTable');
            tableBody.innerHTML = '';
            
            // Carregar larguras das colunas salvas
            loadColumnWidths();
            
            items.forEach(item => {
                const row = document.createElement('tr');
                
                // Verificar se o item está prestes a expirar
                const endDate = new Date(item.endDate);
                const today = new Date();
                const diffTime = endDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let rowClass = '';
                let statusBadge = '';
                
                if (diffDays <= settings.alertDays && diffDays > 0) {
                    rowClass = 'table-warning';
                    statusBadge = '<span class="badge bg-warning">Expira em ' + diffDays + ' dias</span>';
                } else if (diffDays <= 0) {
                    rowClass = 'table-danger';
                    statusBadge = '<span class="badge bg-danger">Expirado</span>';
                } else {
                    statusBadge = '<span class="badge bg-success">Ativo</span>';
                }
                
                row.className = rowClass;
                
                const sazonalidadeClass = getSazonalidadeClass(item.sazonalidade);
                const sazonalidadeBadge = `<span class="badge ${sazonalidadeClass} sazonalidade-badge">${item.sazonalidade}</span>`;
                
                // Observações com truncamento personalizado
                const observacoesHTML = item.observacoes ? 
                    `<div class="text-truncate-custom" title="${item.observacoes}">${item.observacoes}</div>` : 
                    '-';
                
                // Botão de remover SEMPRE ativo para todas as ações
                let removeButton = `<button class="btn btn-sm btn-danger" onclick="removeItem(${item.id})" title="Remover oferta">
                    <i class="bi bi-trash"></i>
                </button>`;
                
                row.innerHTML = `
                    <td><div class="text-truncate-custom" title="${item.name}">${item.name}</div></td>
                    <td><div class="text-truncate-custom" title="${item.sazonalidade}">${sazonalidadeBadge}</div></td>
                    <td><div class="text-truncate-custom" title="${item.internalCode}">${item.internalCode}</div></td>
                    <td><div class="text-truncate-custom" title="${item.eanCode}">${item.eanCode}</div></td>
                    <td>${observacoesHTML}</td>
                    <td>${formatDate(item.startDate)}</td>
                    <td>${formatDate(item.endDate)}</td>
                    <td><div class="text-truncate-custom">${statusBadge}</div></td>
                    <td>${removeButton}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Atualizar contador de itens
            document.getElementById('activeItemsCount').textContent = `${items.length} ${items.length === 1 ? 'item' : 'itens'}`;
        }

        function removeItem(id, confirm = true) {
            const item = items.find(item => item.id === id);
            
            if (!item) return;
            
            let message = 'Deseja remover esta oferta';
            if (new Date(item.endDate) > new Date()) {
                message += ' (ainda ativa)';
            }
            message += ' e mover para o histórico?';
            
            if (!confirm || window.confirm(message)) {
                // Adicionar data de remoção
                item.removedDate = new Date().toISOString().split('T')[0];
                item.active = false;
                item.status = "removido";
                
                // Mover para o histórico
                historyItems.push(item);
                
                // Remover da lista ativa
                items = items.filter(item => item.id !== id);
                
                // Salvar dados
                saveItems();
                saveHistory();
                
                // Atualizar interfaces
                renderItemsTable();
                renderHistoryTable();
                renderCalendar(currentMonth, currentYear);
                checkAlerts();
                
                if (confirm) {
                    alert('Item removido e movido para o histórico!');
                }
            }
        }

        // Funções de Alerta
        function checkAlerts() {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            
            const today = new Date();
            let hasAlerts = false;
            selectedItems = [];
            
            items.forEach(item => {
                const endDate = new Date(item.endDate);
                const diffTime = endDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays <= settings.alertDays && diffDays > 0) {
                    hasAlerts = true;
                    const sazonalidadeClass = getSazonalidadeClass(item.sazonalidade);
                    const observacoesHTML = item.observacoes ? 
                        `<small class="text-muted d-block mt-1"><i>${item.observacoes}</i></small>` : '';
                    
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert-item';
                    alertDiv.innerHTML = `
                        <div class="form-check">
                            <input class="form-check-input checkbox-item" type="checkbox" value="${item.id}" id="alertCheck${item.id}" onchange="toggleItemSelection(${item.id})">
                            <label class="form-check-label" for="alertCheck${item.id}">
                                <strong>${item.name}</strong> <span class="badge ${sazonalidadeClass} sazonalidade-badge">${item.sazonalidade}</span><br>
                                Código: ${item.internalCode} - Expira em ${diffDays} dia(s)<br>
                                <small class="text-muted">${formatDate(item.endDate)}</small>
                                ${observacoesHTML}
                            </label>
                        </div>
                        <button class="btn btn-sm btn-danger mt-1" onclick="removeItem(${item.id})">
                            <i class="bi bi-trash"></i> Remover
                        </button>
                    `;
                    alertsContainer.appendChild(alertDiv);
                } else if (diffDays <= 0) {
                    hasAlerts = true;
                    const sazonalidadeClass = getSazonalidadeClass(item.sazonalidade);
                    const observacoesHTML = item.observacoes ? 
                        `<small class="text-muted d-block mt-1"><i>${item.observacoes}</i></small>` : '';
                    
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert-item danger';
                    alertDiv.innerHTML = `
                        <strong>${item.name}</strong> <span class="badge ${sazonalidadeClass} sazonalidade-badge">${item.sazonalidade}</span><br>
                        Código: ${item.internalCode} - Expirado desde ${Math.abs(diffDays)} dia(s)<br>
                        <small class="text-muted">${formatDate(item.endDate)}</small>
                        ${observacoesHTML}
                        <button class="btn btn-sm btn-danger mt-1" onclick="removeItem(${item.id})">
                            <i class="bi bi-trash"></i> Remover
                        </button>
                    `;
                    alertsContainer.appendChild(alertDiv);
                }
            });
            
            if (!hasAlerts) {
                alertsContainer.innerHTML = '<div class="text-center text-muted">Nenhum alerta no momento</div>';
            }
            
            updateSelectedCount();
        }

        function toggleItemSelection(itemId) {
            const checkbox = document.getElementById(`alertCheck${itemId}`);
            
            if (checkbox.checked) {
                if (!selectedItems.includes(itemId)) {
                    selectedItems.push(itemId);
                }
            } else {
                selectedItems = selectedItems.filter(id => id !== itemId);
            }
            
            updateSelectedCount();
        }

        function selectAllAlerts() {
            const checkboxes = document.querySelectorAll('.checkbox-item');
            const allAlertItems = items.filter(item => {
                const endDate = new Date(item.endDate);
                const today = new Date();
                const diffDays = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return diffDays <= settings.alertDays && diffDays > 0;
            });
            
            if (selectedItems.length === allAlertItems.length) {
                // Desmarcar todos
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedItems = [];
            } else {
                // Marcar todos
                selectedItems = allAlertItems.map(item => item.id);
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
            }
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = selectedItems.length;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('sendBulkEmailBtn').disabled = count === 0;
            
            // Atualizar texto do botão "Todos"
            const allAlertItems = items.filter(item => {
                const endDate = new Date(item.endDate);
                const today = new Date();
                const diffDays = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                return diffDays <= settings.alertDays && diffDays > 0;
            });
            
            const selectAllBtn = document.getElementById('selectAllBtn');
            if (selectedItems.length === allAlertItems.length && allAlertItems.length > 0) {
                selectAllBtn.innerHTML = '<i class="bi bi-x-circle"></i> Nenhum';
            } else {
                selectAllBtn.innerHTML = '<i class="bi bi-check-all"></i> Todos';
            }
        }

        // Funções de Histórico
        function renderHistoryTable() {
            const historyTable = document.getElementById('historyTable');
            historyTable.innerHTML = '';
            
            if (historyItems.length === 0) {
                historyTable.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted">Nenhum item no histórico</td>
                    </tr>
                `;
                return;
            }
            
            historyItems.forEach(item => {
                const sazonalidadeClass = getSazonalidadeClass(item.sazonalidade);
                const sazonalidadeBadge = `<span class="badge ${sazonalidadeClass} sazonalidade-badge">${item.sazonalidade}</span>`;
                
                // Observações reduzidas para histórico
                const observacoesReduzidas = item.observacoes ? 
                    (item.observacoes.length > 30 ? item.observacoes.substring(0, 30) + '...' : item.observacoes) : 
                    '-';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${sazonalidadeBadge}</td>
                    <td>${item.internalCode}</td>
                    <td>${item.eanCode}</td>
                    <td title="${item.observacoes || ''}">${observacoesReduzidas}</td>
                    <td>${formatDate(item.startDate)}</td>
                    <td>${formatDate(item.endDate)}</td>
                    <td>${formatDate(item.removedDate)}</td>
                    <td><span class="badge bg-secondary">${item.status}</span></td>
                `;
                historyTable.appendChild(row);
            });
        }

        function filterHistoryTable() {
            const searchTerm = document.getElementById('historySearch').value.toLowerCase();
            const historyRows = document.querySelectorAll('#historyTable tr');
            
            historyRows.forEach(row => {
                if (row.cells.length === 1) return; // Pular linha de "nenhum item"
                
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function clearHistory() {
            if (historyItems.length === 0) {
                alert('O histórico já está vazio.');
                return;
            }
            
            if (confirm('Tem certeza que deseja limpar todo o histórico? Esta ação não pode ser desfeita.')) {
                historyItems = [];
                saveHistory();
                renderHistoryTable();
                alert('Histórico limpo com sucesso!');
            }
        }

        // Funções de Email
        function openBulkEmailModal() {
            if (selectedItems.length === 0) {
                alert('Selecione pelo menos um item para enviar o email.');
                return;
            }
            
            const emailModal = new bootstrap.Modal(document.getElementById('emailModal'));
            
            document.getElementById('emailTo').value = settings.defaultEmail;
            
            // Construir lista de produtos
            let productsList = '';
            selectedItems.forEach(itemId => {
                const item = items.find(item => item.id === itemId);
                if (item) {
                    const observacoesInfo = item.observacoes ? ` - Obs: ${item.observacoes}` : '';
                    productsList += `- ${item.name} (Sazonalidade: ${item.sazonalidade}, Código: ${item.internalCode}, EAN: ${item.eanCode}, Expira: ${formatDate(item.endDate)}${observacoesInfo})\n`;
                }
            });
            
            let emailBody = document.getElementById('emailBody').value;
            emailBody = emailBody.replace('[LISTA_DE_PRODUTOS]', productsList);
            
            document.getElementById('emailBody').value = emailBody;
            
            emailModal.show();
        }

        function sendEmail() {
            const to = document.getElementById('emailTo').value;
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            
            if (!to) {
                alert('Por favor, informe o destinatário do email.');
                return;
            }
            
            // Simular envio de email
            const mailtoLink = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            
            // Fechar modal
            const emailModal = bootstrap.Modal.getInstance(document.getElementById('emailModal'));
            emailModal.hide();
            
            alert('Email preparado para envio!');
        }

        // Funções de Backup e Exportação
        function exportData() {
            const data = {
                items: items,
                historyItems: historyItems,
                settings: settings,
                columnWidths: JSON.parse(localStorage.getItem('acaoDoRealColumnWidths') || '{}'),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_acao_real_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Dados exportados com sucesso! O arquivo foi salvo na pasta de downloads.');
        }

        function backupData() {
            exportData(); // Reutiliza a função de exportação
        }

        function triggerRestore() {
            document.getElementById('restoreFileInput').click();
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('Deseja restaurar os dados do backup? Isso substituirá todos os dados atuais.')) {
                        items = data.items || [];
                        historyItems = data.historyItems || [];
                        settings = data.settings || { alertDays: 3, defaultEmail: "" };
                        
                        // Restaurar larguras das colunas se existirem
                        if (data.columnWidths) {
                            localStorage.setItem('acaoDoRealColumnWidths', JSON.stringify(data.columnWidths));
                        }
                        
                        saveItems();
                        saveHistory();
                        saveSettings();
                        
                        renderItemsTable();
                        renderHistoryTable();
                        renderCalendar(currentMonth, currentYear);
                        checkAlerts();
                        loadSettings();
                        
                        alert('Dados restaurados com sucesso!');
                    }
                } catch (error) {
                    alert('Erro ao restaurar dados: arquivo inválido.');
                    console.error('Erro ao restaurar:', error);
                }
            };
            reader.readAsText(file);
            
            // Limpar o input para permitir selecionar o mesmo arquivo novamente
            event.target.value = '';
        }

        // Funções de Configuração
        function loadSettings() {
            document.getElementById('alertDays').value = settings.alertDays;
            document.getElementById('defaultEmail').value = settings.defaultEmail;
        }

        function saveSettings() {
            settings.alertDays = parseInt(document.getElementById('alertDays').value);
            settings.defaultEmail = document.getElementById('defaultEmail').value;
            
            localStorage.setItem('acaoDoRealSettings', JSON.stringify(settings));
            
            // Fechar modal
            const configModal = bootstrap.Modal.getInstance(document.getElementById('configModal'));
            configModal.hide();
            
            // Atualizar alertas
            checkAlerts();
            renderItemsTable();
            renderCalendar(currentMonth, currentYear);
            
            alert('Configurações salvas com sucesso!');
        }

        // Funções Auxiliares
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function saveItems() {
            localStorage.setItem('acaoDoRealItems', JSON.stringify(items));
        }

        function saveHistory() {
            localStorage.setItem('acaoDoRealHistory', JSON.stringify(historyItems));
        }
    </script>
</body>
</html>